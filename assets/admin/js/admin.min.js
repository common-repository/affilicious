function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t){var e=new Array,a=new Array;t.fn.doAutosize=function(e){var a=t(this).data("minwidth"),i=t(this).data("maxwidth"),n="",r=t(this),o=t("#"+t(this).data("tester_id"));if(n!==(n=r.val())){var l=n.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");o.html(l);var s=o.width(),u=s+e.comfortZone>=a?s+e.comfortZone:a,d=r.width(),c=d>u&&u>=a||u>a&&i>u;c&&r.width(u)}},t.fn.resetAutosize=function(e){var a=t(this).data("minwidth")||e.minInputWidth||t(this).width(),i=t(this).data("maxwidth")||e.maxInputWidth||t(this).closest(".tagsinput").width()-e.inputPadding,n=t(this),r=t("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:n.css("fontSize"),fontFamily:n.css("fontFamily"),fontWeight:n.css("fontWeight"),letterSpacing:n.css("letterSpacing"),whiteSpace:"nowrap"}),o=t(this).attr("id")+"_autosize_tester";!t("#"+o).length>0&&(r.attr("id",o),r.appendTo("body")),n.data("minwidth",a),n.data("maxwidth",i),n.data("tester_id",o),n.css("width",a)},t.fn.addTag=function(i,n){return n=jQuery.extend({focus:!1,callback:!0},n),this.each(function(){var r=t(this).attr("id"),o=t(this).val().split(e[r]);if(""==o[0]&&(o=new Array),i=jQuery.trim(i),n.unique){var l=t(this).tagExist(i);1==l&&t("#"+r+"_tag").addClass("not_valid")}else var l=!1;if(""!=i&&1!=l){if(t("<span>").addClass("tag").append(t("<span>").text(i).append("&nbsp;&nbsp;"),t("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return t("#"+r).removeTag(escape(i))})).insertBefore("#"+r+"_addTag"),o.push(i),t("#"+r+"_tag").val(""),n.focus?t("#"+r+"_tag").focus():t("#"+r+"_tag").blur(),t.fn.tagsInput.updateTagsField(this,o),n.callback&&a[r]&&a[r].onAddTag){var s=a[r].onAddTag;s.call(this,i)}if(a[r]&&a[r].onChange){var u=o.length,s=a[r].onChange;s.call(this,t(this),o[u-1])}}}),!1},t.fn.removeTag=function(n){return n=unescape(n),this.each(function(){var r=t(this).attr("id"),o=t(this).val().split(e[r]);for(t("#"+r+"_tagsinput .tag").remove(),str="",i=0;i<o.length;i++)o[i]!=n&&(str=str+e[r]+o[i]);if(t.fn.tagsInput.importTags(this,str),a[r]&&a[r].onRemoveTag){var l=a[r].onRemoveTag;l.call(this,n)}}),!1},t.fn.tagExist=function(a){var i=t(this).attr("id"),n=t(this).val().split(e[i]);return jQuery.inArray(a,n)>=0},t.fn.importTags=function(e){var a=t(this).attr("id");t("#"+a+"_tagsinput .tag").remove(),t.fn.tagsInput.importTags(this,e)},t.fn.tagsInput=function(i){var r=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},i),o=0;return this.each(function(){if("undefined"==typeof t(this).attr("data-tagsinput-init")){t(this).attr("data-tagsinput-init",!0),r.hide&&t(this).hide();var i=t(this).attr("id");(!i||e[t(this).attr("id")])&&(i=t(this).attr("id","tags"+(new Date).getTime()+o++).attr("id"));var l=jQuery.extend({pid:i,real_input:"#"+i,holder:"#"+i+"_tagsinput",input_wrapper:"#"+i+"_addTag",fake_input:"#"+i+"_tag"},r);e[i]=l.delimiter,(r.onAddTag||r.onRemoveTag||r.onChange)&&(a[i]=new Array,a[i].onAddTag=r.onAddTag,a[i].onRemoveTag=r.onRemoveTag,a[i].onChange=r.onChange);var s='<div id="'+i+'_tagsinput" class="tagsinput"><div id="'+i+'_addTag">';if(r.interactive&&(s=s+'<input id="'+i+'_tag" value="" data-default="'+r.defaultText+'" />'),s+='</div><div class="tags_clear"></div></div>',t(s).insertAfter(this),t(l.holder).css("width",r.width),t(l.holder).css("min-height",r.height),t(l.holder).css("height",r.height),""!=t(l.real_input).val()&&t.fn.tagsInput.importTags(t(l.real_input),t(l.real_input).val()),r.interactive){if(t(l.fake_input).val(t(l.fake_input).attr("data-default")),t(l.fake_input).css("color",r.placeholderColor),t(l.fake_input).resetAutosize(r),t(l.holder).bind("click",l,function(e){t(e.data.fake_input).focus()}),t(l.fake_input).bind("focus",l,function(e){t(e.data.fake_input).val()==t(e.data.fake_input).attr("data-default")&&t(e.data.fake_input).val(""),t(e.data.fake_input).css("color","#000000")}),void 0!=r.autocomplete_url){autocomplete_options={source:r.autocomplete_url};for(attrname in r.autocomplete)autocomplete_options[attrname]=r.autocomplete[attrname];void 0!==jQuery.Autocompleter?(t(l.fake_input).autocomplete(r.autocomplete_url,r.autocomplete),t(l.fake_input).bind("result",l,function(e,a,n){a&&t("#"+i).addTag(a[0]+"",{focus:!0,unique:r.unique})})):void 0!==jQuery.ui.autocomplete&&(t(l.fake_input).autocomplete(autocomplete_options),t(l.fake_input).bind("autocompleteselect",l,function(e,a){return t(e.data.real_input).addTag(a.item.value,{focus:!0,unique:r.unique}),!1}))}else t(l.fake_input).bind("blur",l,function(e){var a=t(this).attr("data-default");return""!=t(e.data.fake_input).val()&&t(e.data.fake_input).val()!=a?e.data.minChars<=t(e.data.fake_input).val().length&&(!e.data.maxChars||e.data.maxChars>=t(e.data.fake_input).val().length)&&t(e.data.real_input).addTag(t(e.data.fake_input).val(),{focus:!0,unique:r.unique}):(t(e.data.fake_input).val(t(e.data.fake_input).attr("data-default")),t(e.data.fake_input).css("color",r.placeholderColor)),!1});t(l.fake_input).bind("keypress",l,function(e){return n(e)?(e.preventDefault(),e.data.minChars<=t(e.data.fake_input).val().length&&(!e.data.maxChars||e.data.maxChars>=t(e.data.fake_input).val().length)&&t(e.data.real_input).addTag(t(e.data.fake_input).val(),{focus:!0,unique:r.unique}),t(e.data.fake_input).resetAutosize(r),!1):void(e.data.autosize&&t(e.data.fake_input).doAutosize(r))}),l.removeWithBackspace&&t(l.fake_input).bind("keydown",function(e){if(8==e.keyCode&&""==t(this).val()){e.preventDefault();var a=t(this).closest(".tagsinput").find(".tag:last").text(),i=t(this).attr("id").replace(/_tag$/,"");a=a.replace(/[\s]+x$/,""),t("#"+i).removeTag(escape(a)),t(this).trigger("focus")}}),t(l.fake_input).blur(),l.unique&&t(l.fake_input).keydown(function(e){(8==e.keyCode||String.fromCharCode(e.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,\/]+/))&&t(this).removeClass("not_valid")})}}}),this},t.fn.tagsInput.updateTagsField=function(a,i){var n=t(a).attr("id");t(a).val(i.join(e[n]))},t.fn.tagsInput.importTags=function(n,r){t(n).val("");var o=t(n).attr("id"),l=r.split(e[o]);for(i=0;i<l.length;i++)t(n).addTag(l[i],{focus:!1,callback:!1});if(a[o]&&a[o].onChange){var s=a[o].onChange;s.call(n,n,l[i])}};var n=function(e){var a=!1;return 13==e.which||("string"==typeof e.data.delimiter?e.which==e.data.delimiter.charCodeAt(0)&&(a=!0):t.each(e.data.delimiter,function(t,i){e.which==i.charCodeAt(0)&&(a=!0)}),a)}}(jQuery);var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}();jQuery(function(t){var e=window.carbon;if("undefined"==typeof e.fields)return!1;var a=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"getContainerView",value:function(){var t=null;return _.each(e.views,function(e){e.model&&e.model.attributes&&e.model.attributes.title==translations.container&&(t=e)}),t}},{key:"getVariantsView",value:function(){var t=null;return _.each(e.views,function(e){e.templateVariables&&"_affilicious_product_variants"==e.templateVariables.base_name&&(t=e)}),t}},{key:"getTypeView",value:function(){var t=null;return _.each(e.views,function(e){e.templateVariables&&"_affilicious_product_type"==e.templateVariables.base_name&&(t=e)}),t}},{key:"getEnabledAttributesView",value:function(){var t=null;return _.each(e.views,function(e){e.templateVariables&&"_affilicious_product_enabled_attributes"==e.templateVariables.base_name&&(t=e)}),t}},{key:"getVariantEnabledAttributesViews",value:function(){var t=[];return _.each(e.views,function(e){e.templateVariables&&"enabled_attributes"==e.templateVariables.base_name&&t.push(e)}),t}}]),t}(),i=function(){function t(){_classCallCheck(this,t);var e=a.getTypeView(),i=a.getVariantsView(),n=a.getEnabledAttributesView();e&&(e.$el.ready(this.toggleTabs),e.model.on("change:value",this.toggleTabs)),i&&(i.$el.ready(this.toggleAttributes),i.model.on("change:value",this.toggleAttributes)),n&&(n.$el.ready(this.toggleAttributes),n.model.on("change:value",this.toggleAttributes))}return _createClass(t,[{key:"toggleTabs",value:function(){var t=a.getContainerView(),e=a.getTypeView(),i=e.model.get("value"),n=t.$el.find('a[data-id="'+translations.variants.trim().toLowerCase()+'"]').parent(),r=t.$el.find('a[data-id="'+translations.shops.trim().toLowerCase()+'"]').parent();"complex"===i?(n.show(),r.hide()):(n.hide(),r.show())}},{key:"toggleAttributes",value:function(){var t=a.getEnabledAttributesView(),e=a.getVariantEnabledAttributesViews(),i=t.model.get("value"),n=!0,r=!1,o=void 0;try{for(var l,s=e[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var u=l.value;u.model.set("value",i)}}catch(t){r=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}}}]),t}();window.affiliciousProduct=new i}),window.carbon=window.carbon||{},function(t){var e=window.carbon;return"undefined"!=typeof e.fields&&void(e.fields.View.ImageGallery=e.fields.View.Image.extend({events:_.extend({},e.fields.View.prototype.events,{"click .c2_open_media":"openMedia","click .carbon-image-remove":"removeImage"}),initialize:function(){e.fields.View.prototype.initialize.apply(this),this.on("field:beforeRender",this.loadDescriptionTemplate),this.on("field:rendered",this.sortableImages),this.listenTo(this.model,"change:images",this.updateInput),this.listenTo(this.model,"change:value",this.render)},sortableImages:function(){var e=this,a=this.$("ul.carbon-image-gallery");a.sortable({items:"li.carbon-image",cursor:"move",helper:"clone",scrollSensitivity:42,forcePlaceholderSize:!0,opacity:.75,forceHelperSize:!1,placeholder:"carbon-sortable-placeholder",update:function(){var i=[];a.find("li.carbon-image").each(function(){var e=t(this),a=e.attr("data-image-value"),n=e.find("img").attr("src");i.push({value:a,url:n})}),e.model.set("images",i)}})},openMedia:function(t){var e=this,a=this.model.get("type"),i=(this.model.get("images"),this.model.get("window_button_label")),n=this.model.get("window_label"),r=this.model.get("type_filter"),o=this.model.get("value_type"),l={};l[a]=wp.media.frames.crbMediaField=wp.media({title:n?n:crbl10n.title,library:{type:r},button:{text:i},multiple:!0});var s=l[a];s.on("select",function(){var t=s.state().get("selection").toJSON(),a=_.clone(e.model.get("images"));_.each(t,function(t){a.push({value:t[o],url:t.url})}),e.model.set("images",a)}),s.open(),t.preventDefault()},updateInput:function(t){console.log(t);var e=this.$("input.carbon-image-gallery-field"),a=t.get("images"),i=_.map(a,function(t){return t.value}),n=i.join();e.val(n).trigger("change")},removeImage:function(t){for(var e=this.$(t.currentTarget),a=e.parents("ul.carbon-image-gallery").children(),i=e.parents("li.carbon-image"),n=_.clone(this.model.get("images")),r=a.index(i),o=[],l=0;l<n.length;l++)l!=r&&o.push(n[l]);this.model.set("images",o)}}))}(jQuery),window.carbon=window.carbon||{},function(t){var e=window.carbon;return"undefined"!=typeof e.fields&&(e.fields.Model.Tags=e.fields.Model.extend({initialize:function(){e.fields.Model.prototype.initialize.apply(this)}}),void(e.fields.View.Tags=e.fields.View.extend({initialize:function(){e.fields.View.prototype.initialize.apply(this),this.on("field:rendered",this.initField)},initField:function(){var e=this;t(".aff-tags").tagsInput({width:"100%",height:"auto",defaultText:translations.addTag,interactive:!0,delimiter:";",minChars:1,maxChars:100,placeholderColor:"#666666",onChange:function(){e.model.set("value",t('input[name="'+e.templateVariables.name+'"]').val())}})}})))}(jQuery),jQuery(function(t){var e,a=t("#product_image_gallery"),i=t("#product_images_container").find("ul.product_images");t(".add_product_images").on("click","a",function(n){var r=t(this);return n.preventDefault(),e?void e.open():(e=wp.media.frames.product_gallery=wp.media({title:r.data("choose"),button:{text:r.data("update")},states:[new wp.media.controller.Library({title:r.data("choose"),filterable:"all",multiple:!0})]}),e.on("select",function(){var t=e.state().get("selection"),n=a.val();t.map(function(t){if(t=t.toJSON(),t.id){n=n?n+","+t.id:t.id;var e=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;i.append('<li class="image" data-attachment_id="'+t.id+'"><img src="'+e+'" /><ul class="actions"><li><a href="#" class="delete" title="'+r.data("delete")+'">'+r.data("text")+"</a></li></ul></li>")}}),a.val(n)}),void e.open())}),i.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")},update:function(){var e="";t("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var a=t(this).attr("data-attachment_id");e=e+a+","}),a.val(e)}}),t("#product_images_container").on("click","a.delete",function(){t(this).closest("li.image").remove();var e="";return t("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var a=t(this).attr("data-attachment_id");e=e+a+","}),a.val(e),t("#tiptip_holder").removeAttr("style"),t("#tiptip_arrow").removeAttr("style"),!1})});