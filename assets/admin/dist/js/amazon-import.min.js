!function e(t,i,n){function o(a,r){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!r&&l)return l(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[a]={exports:{}};t[a][0].call(c.exports,function(e){var i=t[a][1][e];return o(i||e)},c,c.exports,e,t,i,n)}return i[a].exports}for(var s="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var o=e("./model/import"),s=n(o),a=e("./view/import"),r=n(a),l=new s.default;new r.default({model:l}).render()},{"./model/import":7,"./view/import":18}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.Model.extend({defaults:{action:"new-product",mergeProductId:null}});i.default=n},{}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.Model.extend({defaults:{shop:null,newShopName:null,addedShops:[]},addShop:function(e){var t=this.get("addedShops");t.push(e),this.set({shop:e.slug,newShopName:null,addedShops:t})}});i.default=n},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.Model.extend({defaults:{status:"publish"}});i.default=n},{}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.Model.extend({defaults:{taxonomy:null,terms:null}});i.default=n},{}],6:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var o=e("./config-shop"),s=n(o),a=e("./config-status"),r=n(a),l=e("./config-taxonomy"),u=n(l),c=e("./config-action"),h=n(c),d=Backbone.Model.extend({initialize:function(){this.shop=new s.default,this.status=new r.default,this.taxonomy=new u.default,this.action=new h.default},parse:function(){return{shop:this.shop.get("shop"),newShopName:this.shop.get("newShopName"),status:this.status.get("status"),taxonomy:this.taxonomy.get("taxonomy"),terms:this.taxonomy.get("terms"),action:this.action.get("action"),mergeProductId:this.action.get("mergeProductId")}}});i.default=d},{"./config-action":2,"./config-shop":3,"./config-status":4,"./config-taxonomy":5}],7:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var o=e("./search"),s=n(o),a=e("./config"),r=n(a),l=Backbone.Model.extend({defaults:{action:"aff_product_admin_amazon_import"},initialize:function(){this.search=new s.default,this.config=new r.default,this.search.on("aff:amazon-import:import-results-item",this.import,this)},import:function(e){var t=this,i={product:{name:e.get("name"),type:e.get("type"),shops:e.get("shops"),custom_values:e.get("custom_values")},config:this.config.parse(),form:this.search.form.parse()};jQuery.ajax({type:"POST",url:this._buildUrl(),data:i}).done(function(i){var n=((i||{}).data||{}).shop_template||null;n&&t.config.shop.addShop(n),e.showSuccessMessage()}).fail(function(t){var i=((((t||{}).responseJSON||{}).data||{})[0]||{}).message||null;e.showErrorMessage(i)})},_buildUrl:function(){return affAdminAmazonImportUrls.ajax+"?action="+this.get("action")}});i.default=l},{"./config":6,"./search":12}],8:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.Model.extend({defaults:{term:"",type:"keywords",category:"All",minPrice:null,maxPrice:null,condition:"New",sort:"-price",withVariants:"no",loading:!1,error:!1,errorMessage:null,noResults:!1,noResultsMessage:null,providerConfigured:!1},parse:function(){return{term:this.get("term"),type:this.get("type"),category:this.get("category"),minPrice:this.get("minPrice"),maxPrice:this.get("maxPrice"),sort:this.get("sort"),condition:this.get("condition"),withVariants:this.get("withVariants")}},submit:function(){this.set({loading:!0,error:!1,errorMessage:null,noResults:!1,noResultsMessage:null}),this.trigger("aff:amazon-import:search:search-form:submit",this)},done:function(){this.set("loading",!1),this.trigger("aff:amazon-import:search:search-form:done",this)},noResults:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.set({loading:!1,noResults:!0,noResultsMessage:e}),this.trigger("aff:amazon-import:search:search-form:no-results",this)},error:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.set({loading:!1,error:!0,errorMessage:e}),this.trigger("aff:amazon-import:search:search-form:error",this)}});i.default=n},{}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.Model.extend({defaults:{enabled:!0,loading:!1,noResults:!1,error:!1,errorMessage:null},load:function(){this.set("loading",!0),this.trigger("aff:amazon-import:search:load-more:load",this)},done:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.set({loading:!1,enabled:e}),this.trigger("aff:amazon-import:search:load-more:done",this)},noResults:function(){this.set({loading:!1,noResults:!0}),this.trigger("aff:amazon-import:search:load-more:no-results",this)},error:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.set({enabled:!0,loading:!1,error:!0,errorMessage:e}),this.trigger("aff:amazon-import:search:load-more:error",this)}});i.default=n},{}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.Model.extend({defaults:{loading:!1,success:!1,successMessage:null,error:!1,errorMessage:null},import:function(){this.set("loading",!0),this.trigger("aff:amazon-import:search:results:item:import",this)},showSuccessMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.set({loading:!1,success:!0,successMessage:e,error:!1,errorMessage:null,custom_values:{already_imported:!0}}),this.trigger("aff:amazon-import:search:results:item:success",this)},showErrorMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.set({loading:!1,success:!1,successMessage:null,error:!0,errorMessage:e}),this.trigger("aff:amazon-import:search:results:item:error",this)}});i.default=n},{}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./search-results-item"),o=function(e){return e&&e.__esModule?e:{default:e}}(n),s=Backbone.Collection.extend({model:o.default,initialize:function(){this.on("sync",this.initImportListeners,this)},parse:function(e){return e&&e.success?e.data:[]},importItem:function(e){this.trigger("aff:amazon-import:search:results:import-item",e)},initImportListeners:function(){this.forEach(this._initImportListener,this)},_initImportListener:function(e){e.on("aff:amazon-import:search:results:item:import",this.importItem,this)}});i.default=s},{"./search-results-item":10}],12:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var o=e("./search-form"),s=n(o),a=e("./search-load-more"),r=n(a),l=e("./search-results"),u=n(l),c=Backbone.Model.extend({defaults:{started:!1,action:"aff_product_admin_amazon_search",page:1},initialize:function(e){this.form=new s.default,this.results=new u.default,this.loadMore=new r.default,this.page=e&&e.page?e.page:1,this.results.on("aff:amazon-import:search:results:import-item",this.import,this),this.form.on("aff:amazon-import:search:search-form:submit",this.start,this),this.loadMore.on("aff:amazon-import:search:load-more:load",this.load,this)},start:function(){var e=this;null!==this.form.get("term")&&(this.set("page",1),this.results.url=this._buildUrl(),this.results.fetch().done(function(t){e.loadMore.set("enabled",e._isLoadMoreEnabled(t)),e._hasResults(t)?e.form.done():e.form.noResults()}).fail(function(t){var i=((((t||{}).responseJSON||{}).data||{})[0]||{}).message||null;e.form.error(i),e.loadMore.set("enabled",!1)}).always(function(){e.set("started",!0)}))},load:function(){var e=this;this.set("page",this.get("page")+1),this.results.url=this._buildUrl(),this.results.fetch({remove:!1}).done(function(t){e.loadMore.done(e._isLoadMoreEnabled(t))}).fail(function(){var t=((((result||{}).responseJSON||{}).data||{})[0]||{}).message||null;e.loadMore.error(t)})},import:function(e){this.trigger("aff:amazon-import:import-results-item",e)},_buildUrl:function(){return affAdminAmazonImportUrls.ajax+"?action="+this.get("action")+"&term="+this.form.get("term")+"&type="+this.form.get("type")+"&category="+this.form.get("category")+"&min-price="+this.form.get("minPrice")+"&max-price="+this.form.get("maxPrice")+"&condition="+this.form.get("condition")+"&sort="+this.form.get("sort")+"&with-variants="+this.form.get("withVariants")+"&page="+this.get("page")},_isLoadMoreEnabled:function(e){return e&&e.data&&e.data.length>0&&this.get("page")<5&&"keywords"===this.form.get("type")},_hasResults:function(e){return e&&e.data&&e.data.length>0}});i.default=c},{"./search-form":8,"./search-load-more":9,"./search-results":11}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.View.extend({el:"#aff-amazon-import-config-action",events:{'change input[name="action"]':"_onChange",'change input[name="merge-product-id"]':"_onChange",submit:"_onChange"},initialize:function(){var e=jQuery("#aff-amazon-import-config-action-template");this.template=_.template(e.html())},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._selectize(),this},_onChange:function(e){e.preventDefault();var t=this.$el.find('input[name="action"]:checked'),i=this.$el.find('input[name="merge-product-id"]'),n=i.selectize()[0].selectize;"merge-product"===t.val()?n.enable():n.disable(),this.model.set({action:t.val(),mergeProductId:i.val()})},_selectize:function(){this.$el.find('input[name="merge-product-id"]').selectize({maxItems:1,valueField:"id",labelField:"name",searchField:"name",create:!1,load:function(e,t){if(!e.length)return t();jQuery.ajax({url:affAdminAmazonImportUrls.apiRoot+"wp/v2/aff-products/?status=publish,draft&search="+e,type:"GET",data:{post_parent:0},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",affAdminAmazonImportUrls.nonce)},error:function(){t()},success:function(e){e=e.map(function(e){return{id:e.id,name:e.title.rendered}}),t(e)}})}})}});i.default=n},{}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.View.extend({el:"#aff-amazon-import-config-shop",events:{'change input[name="shop"]':"_onChange",'blur input[name="new-shop-name"]':"_onChange",submit:"_onChange"},initialize:function(){var e=jQuery("#aff-amazon-import-config-shop-template").html();this.template=_.template(e),this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._initShop(),this._checkShop(),this},_onChange:function(e){e.preventDefault();var t=this.$el.find('input[name="shop"]:checked'),i=this.$el.find('input[name="new-shop-name"]');this.model.set({shop:t.val(),newShopName:"new-shop"===t.val()?i.val():null})},_initShop:function(){var e=this.$el.find('input[name="shop"]');return null==this.model.get("shop")&&this.model.set("shop",e.first().val()),this},_checkShop:function(){var e=this.$el.find('input[name="shop"]'),t=null==this.model.get("shop")?e.first().val():this.model.get("shop");return e.val([t]),this}});i.default=n},{}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.View.extend({el:"#aff-amazon-import-config-status",events:{'change input[name="status"]':"_onChange",submit:"_onChange"},initialize:function(){var e=jQuery("#aff-amazon-import-config-status-template").html();this.template=_.template(e),this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},_onChange:function(e){e.preventDefault();var t=this.$el.find('input[name="status"]:checked');this.model.set({status:t.val()})}});i.default=n},{}],16:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.View.extend({el:"#aff-amazon-import-config-taxonomy",events:{'change select[name="taxonomy"]':"_onChange",'change input[name="terms"]':"_onChange",submit:"_onChange"},initialize:function(){var e=jQuery("#aff-amazon-import-config-taxonomy-template");this.template=_.template(e.html()),this.listenTo(this.model,"change:taxonomy",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._selectize(),this},_onChange:function(e){e.preventDefault();var t=this.$el.find('select[name="taxonomy"]'),i=this.$el.find('input[name="terms"]'),n=i.selectize()[0].selectize;null===t.val()||"none"===t.val()?n.disable():n.enable(),this.model.set({taxonomy:"none"!==t.val()?t.val():null,terms:i.val()})},_selectize:function(){var e=this,t=affAdminAmazonImportUrls.apiRoot,i=affAdminAmazonImportUrls.nonce;this.$el.find('input[name="terms"]').selectize({delimiter:",",valueField:"slug",labelField:"name",searchField:"name",create:!1,load:function(n,o){var s=e.model.get("taxonomy");if(!n.length||!s)return o();jQuery.ajax({url:t+"wp/v2/"+s,type:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",i)},error:function(){o()},success:function(e){e=e.map(function(e){return{id:e.id,name:e.name,slug:e.slug,taxonomy:e.taxonomy}}),o(e)}})}})}});i.default=n},{}],17:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var o=e("./config-shop"),s=n(o),a=e("./config-status"),r=n(a),l=e("./config-taxonomy"),u=n(l),c=e("./config-action"),h=n(c),d=Backbone.View.extend({el:"#aff-amazon-import-config",initialize:function(){this.shop=new s.default({model:this.model.shop}),this.status=new r.default({model:this.model.status}),this.taxonomy=new u.default({model:this.model.taxonomy}),this.action=new h.default({model:this.model.action})},render:function(){return this.shop.render(),this.status.render(),this.taxonomy.render(),this.action.render(),this}});i.default=d},{"./config-action":13,"./config-shop":14,"./config-status":15,"./config-taxonomy":16}],18:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var o=e("./search"),s=n(o),a=e("./config"),r=n(a),l=Backbone.View.extend({el:"#aff-amazon-import",initialize:function(){this.search=new s.default({model:this.model.search}),this.config=new r.default({model:this.model.config})},render:function(){return this.search.render(),this.config.render(),this}});i.default=l},{"./config":17,"./search":23}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.View.extend({el:"#aff-amazon-import-search-form",events:{'change select[name="type"]':"change",'change select[name="category"]':"change",submit:"submit"},initialFocus:!1,initialize:function(){var e=jQuery("#aff-amazon-import-search-form-template").html(),t=this.$el.data("provider-configured");this.template=_.template(e),this.model.set("providerConfigured",!0===t||"true"===t),this.model.on("change",this.render,this)},render:function(){this.$el.html(this.template(this.model.attributes));var e=this.$el.find('input[name="term"]'),t=this.$el.find('select[name="type"]'),i=this.$el.find('select[name="category"]'),n=this.$el.find('input[name="min-price"]'),o=this.$el.find('input[name="max-price"]'),s=this.$el.find('select[name="condition"]'),a=this.$el.find('select[name="sort"]'),r=this.$el.find('select[name="with-variants"]');return this.initialFocus||(e.focus(),this.initialFocus=!0),t.val(this.model.get("type")),i.val(this.model.get("category")),n.val(this.model.get("minPrice")),o.val(this.model.get("maxPrice")),s.val(this.model.get("condition")),a.val(this.model.get("sort")),r.val(this.model.get("withVariants")),this},submit:function(e){e.preventDefault(),this.change(),this.model.submit()},change:function(){var e=this.$el.find('input[name="term"]'),t=this.$el.find('select[name="type"]'),i=this.$el.find('select[name="category"]'),n=this.$el.find('input[name="min-price"]'),o=this.$el.find('input[name="max-price"]'),s=this.$el.find('select[name="condition"]'),a=this.$el.find('select[name="sort"]'),r=this.$el.find('select[name="with-variants"]');this.model.set({term:0!==e.length?e.val():this.model.get("term"),type:0!==t.length?t.val():this.model.get("type"),minPrice:0!==n.length?n.val():this.model.get("minPrice"),maxPrice:0!==o.length?o.val():this.model.get("maxPrice"),condition:0!==s.length?s.val():this.model.get("condition"),sort:0!==a.length?a.val():this.model.get("sort"),category:0!==i.length?i.val():this.model.get("category"),withVariants:0!==r.length?r.val():this.model.get("withVariants")})}});i.default=n},{}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.View.extend({el:"#aff-amazon-import-search-load-more",events:{"click .aff-import-search-load-more-button":"load"},initialize:function(){var e=jQuery("#aff-amazon-import-search-load-more-template").html();this.template=_.template(e),this.model.on("change",this.render,this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},load:function(){this.model.load()}});i.default=n},{}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Backbone.View.extend({tagName:"div",className:"",events:{"click .aff-import-search-results-item-variants-show-all":"showAll","click .aff-import-search-results-item-actions-import":"import","click .aff-import-search-results-item-actions-reimport":"import"},initialize:function(){var e=jQuery("#aff-amazon-import-search-results-item-template").html();this.template=_.template(e),this.model.on("change",this.render,this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},showAll:function(e){e.preventDefault(),this.$el.find(".aff-import-search-results-item-variants-show-all").hide(),this.$el.find(".aff-import-search-results-item-variants-item").show()},import:function(e){e.preventDefault(),this.model.import()}});i.default=n},{}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("./search-results-item"),o=function(e){return e&&e.__esModule?e:{default:e}}(n),s=Backbone.View.extend({el:"#aff-amazon-import-search-results",initialize:function(e){var t=this;this.collection=e.collection,this.collection.bind("reset",function(){return t.render()}),this.collection.bind("add",function(){return t.render()}),this.collection.bind("remove",function(){return t.render()}),this.collection.bind("sync",function(){return t.render()})},render:function(){this._addAll()},_addAll:function(){this.$el.empty(),this.collection.forEach(this._addOne,this)},_addOne:function(e){var t=new o.default({model:e});this.$el.append(t.render().el)}});i.default=s},{"./search-results-item":21}],23:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var o=e("./search-form"),s=n(o),a=e("./search-load-more"),r=n(a),l=e("./search-results"),u=n(l),c=Backbone.View.extend({el:"#aff-amazon-import-search",initialize:function(){this.form=new s.default({model:this.model.form}),this.results=new u.default({collection:this.model.results}),this.loadMore=new r.default({model:this.model.loadMore}),this.model.on("change",this.render,this)},render:function(){return this.form.render(),this.results.render(),this.model.get("started")&&this.loadMore.render(),this}});i.default=c},{"./search-form":19,"./search-load-more":20,"./search-results":22}]},{},[1]);